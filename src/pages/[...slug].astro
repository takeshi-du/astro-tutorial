---
// src/pages/[...slug].astro (新規作成、src/pages/blog/[id].astro は削除)
import { getCollection, getEntry } from 'astro:content';
import BlogPostLayout from '../layouts/BlogPostLayout.astro'; // レイアウトへのパスが変わることに注意
import { Image } from 'astro:assets'; // ← Imageコンポーネントをインポート

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => {
    // params.slug に設定する値を決定
    let slugPath;
    if (post.data.url) {
      // フロントマターのurlがあれば、それをパスとする
      slugPath = post.data.url;
    } else {
      // なければファイルパスに基づくパス (例: 'blog/html/html-custom')
      // post.id は 'blog/html/html-custom.md' のようなので、
      // ディレクトリ部分 + ファイル名(拡張子なし) を使う
      slugPath = post.id.replace(/\.md$/, ''); // .mdを除去
    }

    return {
      // params.slug は Astro.params.slug でアクセスでき、
      // URL の '/.../' の部分の文字列になる
      params: { slug: slugPath },
      props: { post }, // 記事データを渡す
    };
  });
}

const { post } = Astro.props;
const { Content } = await post.render();
---
<BlogPostLayout title={post.data.title}>
  <article>
    <h1>{post.data.title}</h1>

    {/* ↓ アイキャッチ画像を表示 */}
    {post.data.featureImage && post.data.featureImageAlt && (
      <Image
        src={post.data.featureImage}
        alt={post.data.featureImageAlt}
        width={720}  {/* 表示したい幅を指定 */}
        aspectRatio="16:9" {/* アスペクト比を指定すると高さは自動計算されることが多い */}
        format="webp" {/* 最適なフォーマットを指定 (任意) */}
        quality={80} {/* 画質を指定 (任意) */}
        loading="lazy" {/* 遅延読み込み (任意) */}
        decoding="async" {/* 非同期デコード (任意) */}
      />
    )}
    {/* ↑ ここまで */}

    <p>公開日: {post.data.pubDate.toLocaleDateString()}</p>
    {post.data.tags && (
      <p>タグ: {post.data.tags.join(', ')}</p>
    )}
    <hr />
    <Content />
  </article>
</BlogPostLayout>
